<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Today's Site Reports</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

    <style>
      .photo-column img {
        max-width: 100px;
        height: auto;
        object-fit: cover;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      td {
        word-break: break-word;
        white-space: normal;
      }
    </style>
  </head>
  <body>
    <!-- Main Content -->
    <div class="container my-2" id="content-to-pdf">
      <!-- Navigation -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="/" class="btn btn-primary">Home</a>
        <a href="/" class="btn btn-success">Want to Add?</a>
      </div>

      <!-- Title -->
      <h2 class="text-center mb-4">
        Today's Reports <span class="text-muted">({{ today_date }})</span>
      </h2>

      <!-- Reports Table -->
      {% if reports_for_sites %}
      <!--  -->
      {% for site, reports in reports_for_sites.items %}
      <div class="mb-5">
        <h4 class="text-success">{{ site }}</h4>
        {% if reports %}
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="table-dark">
              <tr>
                <th>Work Type</th>
                <th>Floor</th>
                <th>Members</th>
                <th>Equipments Used</th>
                <th>Report</th>
                <th>Photo</th>
                <th>Edit</th>
              </tr>
            </thead>
            <tbody>
              {% for report in reports %}
              <tr style="border-bottom: 2px solid black">
                <td>{{ report.work_type }}</td>
                <td>{{ report.floor_number }}</td>
                <td>{{ report.members_count }}</td>
                <td class="text-wrap" style="max-width: 200px">
                  {{ report.equipments_used }}
                </td>
                <td class="text-wrap" style="max-width: 300px">
                  <p>{{ report.report_details }}</p>
                </td>
                <td class="photo-column">
                  {% if report.photos %}
                  <img src="{{ report.photos.url }}" alt="Report Photo" />
                  {% else %}
                  <span class="text-danger">No Photo</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  <a
                    href="{% url 'edit-report' report.id %}"
                    class="btn btn-warning btn-sm"
                  >
                    Edit
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-danger">No reports for this site today.</p>
        {% endif %}
      </div>
      {% endfor %}
      <!--  -->
      {% else %}
      <p class="text-center text-danger">No reports available for today.</p>
      {% endif %}

      <!-- Link to View All Reports -->
      <div class="mt-4 text-center">
        <a href="/all-sites" class="btn btn-primary">View All Reports</a>
      </div>
      <!-- download btn -->
      <div class="mt-4 text-center">
        <button id="download-pdf-btn">Download PDF</button>
      </div>
    </div>
    <script>
      document
        .getElementById("download-pdf-btn")
        .addEventListener("click", function () {
          var element = document.getElementById("content-to-pdf");

          var options = {
            margin: 1,
            filename: "todayReport.pdf",
            image: { type: "jpeg", quality: 0.98 },
            html2canvas: { scale: 4 },
            jsPDF: { unit: "in", format: "letter", orientation: "portrait" },
          };

          html2pdf().from(element).set(options).save();
        });
    </script>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
